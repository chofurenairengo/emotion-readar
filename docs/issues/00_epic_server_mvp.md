# [Epic] サーバーサイドMVP実装 - 感情解析・音声認識・LLM応答生成

## 概要

MediaPipeの感情スコアと音声データを受け取り、STT処理後にLLMで推論を行い、応答文3パターンと感情の言語化を返すサーバーサイドMVPの実装。

## 背景

- XRデバイスを用いた対面コミュニケーション支援システムのバックエンド
- Android（Kotlin）側でMediaPipeによる顔ランドマーク抽出・感情スコア算出を実施
- サーバーは感情スコアと音声を受け取り、LLM推論に集中

## 全体アーキテクチャ

```
[Kotlin/Android]
    │
    ├─ 感情スコア（MediaPipe処理後）
    ├─ 音声データ（raw/圧縮）
    │
    ▼ WebSocket
┌─────────────────────────────────────────────────┐
│                    Server                        │
│                                                  │
│  ┌─────────────┐    ┌─────────────┐             │
│  │ STTサービス  │───▶│ 会話履歴    │             │
│  └─────────────┘    │ 管理        │             │
│                      └──────┬──────┘             │
│                             │                    │
│  ┌─────────────┐            │                    │
│  │ 感情解釈    │────────────┤                    │
│  │ サービス    │            │                    │
│  └─────────────┘            ▼                    │
│                      ┌─────────────┐             │
│                      │ LLMサービス │             │
│                      └──────┬──────┘             │
│                             │                    │
│                             ▼                    │
│                      ┌─────────────┐             │
│                      │ 応答生成    │             │
│                      │ サービス    │             │
│                      └──────┬──────┘             │
└─────────────────────────────┼────────────────────┘
                              │
                              ▼ WebSocket
                        [Unity/HUD]
```

## 子Issue一覧

| # | Issue | 優先度 | 依存関係 |
|---|---|---|---|
| 1 | DTO定義（型定義） | P0 | なし |
| 2 | STTサービス実装 | P0 | #1 |
| 3 | 会話履歴管理サービス実装 | P0 | #1 |
| 4 | 感情解釈サービス実装 | P0 | #1 |
| 5 | LLMサービス実装 | P0 | #1 |
| 6 | 応答生成サービス実装（統合） | P0 | #2, #3, #4, #5 |
| 7 | WebSocketハンドラ拡張 | P0 | #1, #6 |

## 実装順序

```
1. DTO定義（型を先に決める）
   ↓
2. STTサービス（音声→テキスト）
   ↓  ※2-5は並行実装可能
3. 会話履歴サービス（コンテキスト管理）
   ↓
4. 感情解釈サービス（スコア→言語化）
   ↓
5. LLMサービス（Gemini API連携）
   ↓
6. 応答生成サービス（統合）
   ↓
7. WebSocketハンドラ拡張
```

## 完了条件

- [ ] 全子Issueがクローズされている
- [ ] WebSocket経由で感情スコア＋音声を受信できる
- [ ] 音声がテキストに変換される
- [ ] LLMが応答文3パターンを生成する
- [ ] 感情が自然言語で表現される
- [ ] E2Eテストが通る

## 技術スタック

- Python 3.14 / FastAPI
- Gemini API（LLM）
- Whisper または Google Cloud Speech-to-Text（STT）
- WebSocket

## 関連ドキュメント

- `CLAUDE.md` - プロジェクトガイドライン
- `README.md` - システム設計仕様
